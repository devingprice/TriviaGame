var qAKey = [
    {
        question: 'The rules that pirates lived by while on ship were known as?',
        answerList: ['Laws', 'Rules', 'Articles', 'Code'],
        displayType: 'twoByTwo',
        answer: 2,
        explaination: 'Every pirate ship had its own articles; some were common to all ships such as no women allowed on ship, punishment for stealing, running away, or keeping secrets was death, and the crew shared the bounty equally. Everyone had to follow the rules, even the captain.'
    },
    {
        question: 'When was the "Golden Era of Piracy" in the Caribbean?',
        answerList: ['1560 to 1580', '1650 to 1730', '1590 to 1630', '1750 to 1800'],
        displayType: 'twoByTwo',
        answer: 1,
        explaination: 'Piracy existed in the Caribbean for many years, even till the mid 1800s, but after the Golden Era, attacks became less frequent because ships would sail in fleets accompanied by other ships to protect the treasure: in other words, they sailed in convoy.'
    },
    {
        question: '<img src="https://blackphoenixalchemylab.com/wp-content/uploads/2012/12/Jolly-Roger.jpg"> <br> This flag is known as:',
        answerList: ['The Black Cross', 'The Flying Dutchman', 'The Jolly Roger', 'The Bones of Death'],
        displayType: 'twoByTwo',
        answer: 2,
        explaination: 'The Jolly Roger usually consists of a skull and two diagonal bones, but some pirate used more elaborate versions including various red flags and versions of the Jolly Roger with up to three skulls.', 
    },
    {
        question: "Who was this Scotsman, who as a privateer, loaned the runner and tackle from his ship for hoisting the stones that were used in construction of New York's Trinity Church? ",
        answerList: ['William Kidd', 'Henry Morgan', 'Edward Teach', 'Bartholomew Roberts'],
        displayType: 'twoByTwo',
        answer: 0,
        explaination: 'As a member of a joint French and English crew that sailed in the Caribbean, William Kidd and other members of the crew mutinied and removed the captain of the ship on which they sailed and renamed it the "Blessed William". It is disputable if he was actually a pirate or a privateer, but at any rate he was hanged in chains in England as a pirate in 1701. The belief that he left buried treasure "somewhere" has enhanced the legend of Captain Kidd.'
    },
    {
        question: 'During the "Golden Age of Piracy" just two women were ever convicted of piracy. One was Anne Bonney, but who was the other?',
        answerList: ['Mary Reed', 'Gunpowder Gertie', 'Sarah Cutler', 'Rebecca Monroe'],
        displayType: 'twoByTwo',
        answer: 0,
        explaination: 'English woman Mary Read spent her childhood disguised as a boy by her mother. This was because her older (legitimate) brother had died, and their mother wanted to keep getting money from his paternal grandmother. Mary stayed living as a man until she fell in love with a soldier, and revealed herself as a woman so they could be married. After the untimely death of her husband, she took ship for the West Indies. When the ship was attacked and boarded by pirates, Mary joined them. In 1720, Mary took the "king' + "'s" + 'pardon" turned and Privateer, and then joined forces with Anne Bonney and her lover Jack Rackham after they took her ship. The three, along with their crew, were captured that same year and sentenced to death by a court in Jamaica, but both Bonney and Read were spared as they were pregnant.'
    },
    {
        question: 'In 1801, a fleet of notorious Pirates got together and declared war. The First Barbary War had begun, but who had the Pirates declared war on?',
        answerList: ['Ottoman Empire', 'United States', 'The Vatican', 'Each other'],
        displayType: 'twoByTwo',
        answer: 1,
        explaination: 'The Barbary Pirates were based in Tripoli, and had struck fear into the hearts of shipping in the Mediterranean for years. On May 1 1801, they declared war on the United States of America. Prior to the American Revolution and its subsequent independence, American shipping in the Mediterranean had been under the protection of the British Royal Navy, and then the French Navy. By the 1780s however, this was no longer the case, and the pirates operating along the Barbary Coast of North Africa considered US shipping to be fair game. For a while, the US Government had "taken the easy option" and paid tribute to the pirates in exchange for safe passage, but with the election of Thomas Jefferson as President, and extortionate increases in the pirate' + "'s" + ' demands, the situation quickly became untenable. Communications broke down, and the pirates, backed by their various rulers including the Pasha of Tripoli, declared war. Hostilities ended on June 10th 1805.'
    },
    {
        question: 'Charlotte Badger and Catherine Hagerty were the first Australian female pirates. They captured a ship and sailed it to New Zealand. What was the ship' + "'s" + ' name?',
        answerList: [
            'Hesperus',
            'Venus',
            'Edmund Fitzgerald',
            'Sloop John B',
        ],
        displayType: 'twoByTwo',
        answer: 1,
        explaination: '<p>English born&nbsp;Charlotte&nbsp;Badger&nbsp;was sentenced to be transported to Australia for the crime of theft. During her term of penal servitude she performed hard manual labour in a factory, and also gave birth to a daughter.</p><p>After her sentence had ended,&nbsp;Charlotte, her baby, and Catherine Hagerty (a fellow convict whose term was also served) took ship in the Venus heading for New Zealand.</p><p>The captain of the Venus was a sadistic bully, and drove the crew to mutiny. By this time, both&nbsp;Charlotte&nbsp;and Catherine had taken lovers among the crew, and they all continued onto North Island without the captain. They turned to piracy along the way, even though no-one left on board could actually navigate properly.</p><p>Legend has it that after the two women and their lovers settled ashore, the crew continued their piracy, and were eventually captured by Maori tribesmen; the Venus was burned to the waterline, and most of the crew were eaten!<br />They are remembered today as the first white women to settle in New Zealand. Catherine is reported to have fallen ill and died, but nothing is known for sure about the fate of&nbsp;Charlotte, or her child, once settled in New Zealand.</p><p>The story of "The Good Ship Venus" is now (in)famous in the words of a vulgar drinking song (which I have only heard about through my research for this quiz, and have never ever sung or heard sung, oh no no no!).</p>'
    },
    {
        question: 'Perhaps the most famous pirate of all is Blackbeard. What is the name of his ship?',
        answerList: [
            'Great Ranger',
            'Liberty',
            "Queen Anne's Revenge",
            'Rising Sun'
        ],
        displayType: 'twoByTwo',
        answer: 2,
        explaination: "<p>Edward Teach was an Englishman who was both a privateer and a pirate in the Caribbean. Infamous for his brutality, he was a cruel and violent man who struck terror into the hearts of all who had the misfortune to cross him.</p><p>When he was eventually killed in a fight by one Lieutenant Maynard, acting on orders from the Governor of Virginia, Maynard took his head and hung it off the front bowsprit of his ship for the journey home.</p><p>Liberty was the ship of Thomas Tew, Rising Sun sailed under the command of William Moody, and the Great Ranger was the ship of Bartholomew 'Black Bart' Roberts.</p>"
    },
    {
        question: "Which pirate bought his own ship, rather than stealing it, and became a pirate, according to legend, to get away from his wife's nagging?",
        answerList: [
            'Thomas Tew',
            'Charles Vane',
            'Henry Morgan',
            'Stede Bonnet'
        ],
        displayType: 'twoByTwo',
        answer: 3,
        explaination: '<p>Stede Bonnet actually purchased his&nbsp;own ship and hired a crew. This&nbsp;was different from&nbsp;most&nbsp;pirate&nbsp;ships where the crew signed an agreement (Articles) that entitled them to a share&nbsp;of&nbsp;any plunder. The&nbsp;pirate&nbsp;crews also generally elected their own captains. For a short time Stede Bonnet was in a partnership with&nbsp;Blackbeard&nbsp;but&nbsp;Blackbeard&nbsp;basically kept Bonnet a prisoner and made what use he liked&nbsp;of&nbsp;' + "Bonnet's ship, the 'Revenge'.</p>"
    },
    {
        question: 'Which pirate enough money that he was able to retire, only to miss the pirate life and came back only to be killed while trying to capture a prize in the Red Sea?',
        answerList: [
            'Thomas Tew',
            'Henry Avery',
            'Walter Kennedy',
            'Bemjamin Hornigold'
        ],
        displayType: 'twoByTwo',
        answer: 0,
        explaination: "Thomas Tew was a famous pirate whose base was at Madagascar. Tew and his crew took a richly provisioned Indian ship. The booty was so rich that each man of Tew's crew received 3,000 pounds as his share. Retirement didn't agree with Tom Tew, who returned to piracy only to die while attacking another ship."
    },
    {
        question: 'Which pirate was so cruel that, shortly after an instance of interrogating prisoners (and literally eating the heart of one of the prisoners), most of his crew deserted?',
        answerList: [
            'Christopher Mings',
            "Francis l'Olonnais",
            'Jack Sparrow',
            'Nathaniel North'
        ],
        displayType: 'twoByTwo',
        answer: 1,
        explaination: "It is reputed that Francis l'Olonnais once cut the heart out of a prisoner and started to chew on it while interrogating other prisoners. It was shortly after this that his crew deserted him - he was too much of a psychopath for their taste (if you'll pardon the expression)."
    },
    {
        question: 'One of the first English pirates was Lady Aethelflaed. Her father was even more famous than she was. Wwho was he?',
        answerList: [
            'Hengist',
            'Vercingetorix',
            'Alfred the Great',
            'King Canute'
        ],
        displayType: 'twoByTwo',
        answer: 2,
        explaination: '<p>The daughter, sister, and wife of Kings, Aethelflaed lived in violent times. When her husband Aethelred of Mercia was killed fighting the Vikings she took up the leadership of her people and made a pretty good job of it. She defeated the invaders in battle at Derby and Leicester, and even led an army to invade Wales.</p><p>For a woman to lead men to victory in battle was very rare (though not unique, Queen Boudicca of the Iceni had set a precedent) at this period in history.<br />Even the Viking population of Jorvik (York) made a treaty with Aethelflaed in order to have her protection from the new wave of Viking raiders.<br />When Aethelflaed died, her daughter Aelfwyn came to power, but she was ousted by her uncle Edward, King of Wessex, who seized control of Mercia in his bid to unify England under his sole rule.</p>'
    },
    {
        question: 'Which of these pirates was considered the most successful for having taken 400 ships in the space of only three years?',
        answerList: [
            'Bartholemew Roberts',
            'Henry Morgan',
            'Edward Teach',
            'Howell Davis'
        ],
        displayType: 'twoByTwo',
        answer: 0,
        explaination: 'Bartholemew Roberts was captured by pirates in 1719 and ended up joining them. Due to his competency he was elected captain upon the death of the previous captain, Howell Davis. Roberts was killed in 1722, in battle. His crew threw his body overboard rather than let it be taken by the British Navy.'
    },
    {
        question: 'Who was the Cuban pirate who operated from his own country and attacked American ships during the presidency of James Monroe?',
        answerList: [
            'Diabolito',
            'El Mosquito',
            'Monolito',
            'Cubanito'
        ],
        displayType: 'twoByTwo',
        answer: 0,
        explaination: 'Diabolito and other Cuban pirates were chased by the Mosquito Fleet, an American group of vessels in charge of patrolling the Caribbean. After years of hunting for the pirate, he was finally killed in 1823.'
    },
    {
        question: 'Which of these words was used for pirates operating in the Mediterranean?',
        answerList: [
            'Buccaneers',
            'Barbary',
            'Corsairs',
            'Privateers'
        ],
        displayType: 'twoByTwo',
        answer: 2,
        explaination: 'Corsairs preyed upon the shipping lanes of the Mediterranean. The most famous corsairs were from the Barbary Coast of North Africa.'
    },
    {
        question: "Who was known as Queen Elizabeth I's first Sea Dog?",
        answerList: [
            'Henry Morgan',
            'Edward Teach',
            'William Kidd',
            'Francis Drake',
        ],
        displayType: 'twoByTwo',
        answer: 3,
        explaination: 'Francis Drake hated the Spanish after they murdered several friends of his on board a ship. Queen Elizabeth I made him her first Sea Dog, privateers able to hunt down pirates and kill them without the fear of retribution. Any treasure Francis Drake took from a pirate ship, he gave to the queen.'
    },
    {
        question: 'Which of these pirates was considered the most successful for having taken 400 ships in the space of only three years?',
        answerList: [
            'Edward Teach',
            'Henry Morgan',
            'Howell Davis',
            'Bartholemew Roberts'
        ],
        displayType: 'twoByTwo',
        answer: 3,
        explaination: 'Bartholemew Roberts was captured by pirates in 1719 and ended up joining them. Due to his competency he was elected captain upon the death of the previous captain, Howell Davis. Roberts was killed in 1722, in battle. His crew threw his body overboard rather than let it be taken by the British Navy.'
    },
    {
        question: 'This guy was once captured by pirates and held for ransom. Although he was treated well, after his release he took a ship, went after them and killed them all. Who was he?',
        answerList: [
            'Pythagoras',
            'Alexander the Great',
            'Julius Caesar',
            'Augustus'
        ],
        displayType: 'twoByTwo',
        answer: 2,
        explaination: 'Piracy was quite a problem in ancient Rome. At their height, pirates had about 1,000 ships and raided over 400 cities, including Ostia, the port of Rome. Julius Caesar was captured while on a sea voyage and held for ransom until his wealthy family paid up. This was a fairly widespread practice. In the end the effects on Mediterranean trade became so serious that Pompey got the commission to get rid of the pirates, which he did in about three months in 67 BCE.'
    },
    {
        question: 'What do legends say that Anne Bonney did at the age of 13?',
        answerList: [
            "Hung her father's dog from a tree because it snapped at her.",
            "Stole a emerald necklace from her grandmother after hitting her over the head with a club.",
            "Stabbed a servant girl in the belly with a table knife for making her angry.",
            "Burned down the house of a neighboring family because they called her a hooligan."
        ],
        displayType: 'twoByTwo',
        answer: 2,
        explaination: 'History says that Anne had a fiery temper from a very young age. She also was said to have beaten a young sailor almost to death for showing an interest in her.'
    },
    {
        question: '"Walking the plank"' + "was one of the most favored forms of punishments for infractions that ran against the pirates' code.",
        answerList: [
            'True',
            'False'
        ],
        displayType: 'oneByTwo',
        answer: 1,
        explaination: 'Forcing people to "walk the plank" is largely folklore. Generally, the pira' + "tes' favorite form" + ' of punishment was "keelhauling", which involved tying their victims to the boat with a length of rope, tossing them overboard, and then dragging them underneath the ship!'
    },
    {
        question: 'John Rackham had not one but TWO female pirates aboard his ship. This was highly unusual. What nickname was he better known by?',
        answerList: [
            'Calico Jack',
            "Devil's Advocate",
            'John Juan',
            'Alan Adulterer'
        ],
        displayType: 'twoByTwo',
        answer: 0,
        explaination: 'Calico Jack was the more commonly used name for John Rackham. He took a brief break from pirating, accepting a pardon in 1719, but resumed pirating in 1720. After this brief period of renewed activity, he was hanged as a pirate in Jamaica later that same year. '
    }
]


var started = false;
var timeGivenMS = 3000;//60000;//240000;
var numRounds = 10;
var randomSorted = randomSort(qAKey);
var winLose = null;
var bombTimer = null;
var displayTimer = null;
var currRound = 0;

var correctCount = 0;
var incorrectCount = 0;


function displayClock() {
    console.log("clock")
    //var display = $('#timer');
    startTimer((timeGivenMS / 1000));
}
function addZeroIfSingleDigit(num) {
    if (num < 10) {
        return '0' + num;
    } else {
        return num;
    }
}
function startTimer(durationSec) {
    var timer = durationSec;
    var minutes;
    var seconds;
    displayTimer = setInterval(function () {
        minutes = parseInt(timer / 60, 10);
        seconds = parseInt(timer % 60, 10);

        if (--timer <= 0) {
            $('#timer').text("00:00");
            clearInterval(displayTimer)
        } else {
            minutes = addZeroIfSingleDigit(minutes);
            seconds = addZeroIfSingleDigit(seconds);

            $('#timer').text(minutes + ":" + seconds);
        }
    }, 1000);
}

document.addEventListener('click', function () {
    if (!started) {
        started = true;
        startAnim();
        //after delay startQuiz()
        setTimeout(function () {
            lightFire();
            startQuiz();
            console.log('started quiz');
        }, 1000)
    }
})
function startQuiz() {
    // set timeout to timegivenms
    console.log('startquiz')
    bombTimer = setTimeout(function () {
        loseAnim();
        winLose = 'lose';
        displayResultsKey();
    }, timeGivenMS);
    // bomb.start()
    displayClock();
    displayRound(currRound)

}
function randomSort(inputArr) {
    //TODO
    return inputArr;
}
function fixGridClasses(displayType) {
    $('.answer-container').removeClass('oneByTwo twoByTwo')
    if (displayType.length > 0) {
        $('.answer-container').addClass(displayType);
    }
}
function displayRound() {
    console.log('display round', currRound)
    $('.question').html(randomSorted[currRound].question)

    $('.answer-container').empty();
    fixGridClasses(randomSorted[currRound].displayType);
    for (var i = 0; i < randomSorted[currRound].answerList.length; i++) {
        $('.answer-container').append(
            $('<div>', { class: 'answer small-text', 'data-index': i }).text(randomSorted[currRound].answerList[i])
        )
    }
    $('.answer').on('click', function () {
        if (!winLose) {
            randomSorted[currRound].chosen = $(this).attr('data-index');
            transitionQuestion();
        }
    })
}

$('.answer').on('click', function () {
    if (!winLose) {
        randomSorted[currRound].chosen = $(this).attr('data-index');
        transitionQuestion();
    }
})
function checkIfCorrect(qAItem) {
    if (parseInt(qAItem.chosen) === qAItem.answer) {
        return true;
    }
    return false;
}
function transitionQuestion() {
    if ((currRound + 1) === numRounds) {
        win();
    } else {
        currRound++;
        displayRound();
    }
}
function win() {
    winLose = 'win'
    clearInterval(displayTimer)
    clearTimeout(bombTimer)
    console.log('win')
    displayResultsKey();
    putOutFire();
}
function putOutFire() {
    document.querySelector('.progress-rope').style.webkitAnimationPlayState = 'paused';
    $('#rope-end').removeClass('lit');
    //document.querySelector('.lit').style.webkitAnimationPlayState = 'paused';
}

function makeAnswerCollapsables() {
    var coll = document.getElementsByClassName("results-list-item");
    for (var i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function () {
            this.classList.toggle("active-list-item");
            var content = this.querySelector('.collapsable');
            console.log(content)
            if (content.style.maxHeight) {
                content.style.maxHeight = null;
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
            }
        });
    }
}
function displayResultsKey() {
    // div class results + win class or lose class
    $('#results').show();
    $('.answer').hide()
    $('.question').hide()

    //make list
    $('#results').append(
        $('<ol>', { class: 'results-list small-text' })
    )
    randomSorted.filter(function (qAItem) {
        return qAItem.chosen !== undefined;
    }).map(function (qAItem) {

        var correct;
        if (checkIfCorrect(qAItem)) {
            correct = 'correct'
            correctCount++;
        } else {
            correct = 'incorrect'
            incorrectCount++;
        }
        var listItem = $('<li>', { class: 'results-list-item ' + correct })
            .append(
                $('<div>').append($('<p>').html(qAItem.question))
                    .append($('<p>').text("You chose: " +qAItem.answerList[qAItem.chosen]))
                )
            
            .append($('<div>', { class: 'collapsable' }).html(qAItem.explaination))

        $('.results-list').append(listItem)
    })
    makeAnswerCollapsables();
    $('#results').prepend(
        $('<button>', {class:"big-text"}).text("Play Again")
            .on('click', function () {
                playAgain()
            })
    )
    if (winLose === "win") {
        $('#results').prepend($('<h1>', {class:'big-text'}).text("WINNER"))
        $('#results').prepend($('<h3>', {class:'big-text'}).text("# Correct: " + correctCount))
        $('#results').prepend($('<h3>', {class:'big-text'}).text("# Incorrect: " + incorrectCount))
    } else if (winLose === 'false') {
        $('#results').prepend($('<h1>').text("LOSER"))
        $('#results').prepend($('<h3>').text("# Correct: " + correctCount))
        $('#results').prepend($('<h3>').text("# Incorrect: " + incorrectCount))
    }
    console.log(randomSorted)
}
function playAgain() {
    $('.answer').show().empty();
    $('.question').show().empty();
    $('#timer').fadeOut(0).text("00:05").fadeIn();
    $('#results').hide().empty();

    $('#press').fadeIn();

    started = false;
    randomSorted = randomSort(qAKey);
    winLose = null;
    bombTimer = null;
    displayTimer = null;
    currRound = 0;
}




$('#results').hide();
setCSS();
setTimerText(timeGivenMS / 1000);

function setTimerText(durationSec) {
    var minutes = parseInt(durationSec / 60, 10);
    var seconds = parseInt(durationSec % 60, 10);

    if (--durationSec <= 0) {
        $('#timer').text("00:00");
        clearInterval(displayTimer)
    } else {
        minutes = addZeroIfSingleDigit(minutes);
        seconds = addZeroIfSingleDigit(seconds);

        $('#timer').text(minutes + ":" + seconds);
    }
}

function setCSS() {
    var root = document.documentElement;
    root.style.setProperty('--time', (timeGivenMS / 1000) + 's');
    var contW = $(window).width() - 20;
    var contH = $(window).height() - 64;
    if( contW > 800 ){ contW = 800 }
    root.style.setProperty('--cont-w', contW + 'px');
    root.style.setProperty('--cont-h', contH + 'px');
}
function startAnim() {
    //moveBomb
    //fade in rope
    //fade out title
    $('#press').fadeOut(1000);
    //start 3 2 1 countdown
    //after delay move fire from countdown anim to rope start
    setCSS()
    ropeAppear();
}
function lightFire() {
    var rope = document.getElementById('rope-border');
    var ropeEnd = document.getElementById('rope-end');

    rope.classList.remove("progress-rope");
    ropeEnd.classList.remove("lit");

    void rope.offsetWidth;
    void ropeEnd.offsetWidth;

    rope.classList.remove("appear-rope");
    rope.classList.add("progress-rope");
    if(document.querySelector('.progress-rope').style.webkitAnimationPlayState === 'paused'){
        document.querySelector('.progress-rope').style.webkitAnimationPlayState = 'running'
    }
    ropeEnd.classList.add("lit");
}
function ropeAppear(){
    var rope = document.getElementById('rope-border');
    rope.classList.add("appear-rope");
}

function loseAnim() {
    console.log('lose')
    
}

ropeAppear();
